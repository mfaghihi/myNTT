#include <NTL/BasicThreadPool.h>
#include <NTL/FFT.h>
#include <NTL/GF2E.h>
#include <NTL/GF2EX.h>
#include <NTL/GF2X.h>
#include <NTL/GF2XFactoring.h>
#include <NTL/tools.h>
#include <NTL/vector.h>
#include <NTL/vec_lzz_p.h>
#include <NTL/ZZ.h>
#include <NTL/lzz_p.h>
#include <NTL/lzz_pX.h>
#include <NTL/FFT_impl.h>
#include <NTL/lzz_p.h>

#include <algorithm>
#include <cstdint>
#include <forward_list>
#include <fstream>
#include <iostream>
#include <ostream>
#include <memory>
#include <mutex>
#include <set>
#include <sstream>
#include <string>
#include <vector>
#include <NTL/ZZ_pXFactoring.h>
#include <chrono> 
using namespace std::chrono; 

using namespace std;
using namespace NTL;

using NTL::ZZ;
using NTL::zz_p;
typedef NTL::zz_p lzz_p;
using NTL::zz_pX;
typedef NTL::zz_pX lzz_pX;
using NTL::vec_zz_p;
typedef NTL::vec_zz_p vec_lzz_p;
typedef NTL::ZZ word;
using NTL::Vec;

NTL::FFTPrimeInfo* fft_info;

std::pair<Vec<ZZ>,Vec<ZZ>> findprimefators(const ZZ input)
{	
	Vec<ZZ> results;
	Vec<ZZ> powers;
	ZZ tmp = input;
	long j = 0;
	if (tmp % 2 == 0){
		results.append(ZZ(2));
		powers.append(ZZ(1));
		tmp/=2;
		while (tmp % 2 == 0)
		{
			powers[0]++;
			tmp/=2;
		}
	}
	ZZ tmp2=tmp;
	for (ZZ i(3) ; i < tmp+1 ; i+=2)
	{
		if (tmp % i == 0){
			results.append(i);
			powers.append(ZZ(1));
			j++;
			tmp/=i;
			while (tmp % i == 0)
			{
				powers[j]++;
				tmp/=i;
			}
		}

	}
	/*cout<<input <<" = ";
	for (long i = 0 ; i < results.length() ; i ++){
		cout <<results[i]<<"^"<<powers[i];
		if (i!=results.length()-1)
			cout<<" x ";
	}
	cout << endl;*/
	return std::make_pair(results, powers);
}

void findnthRoot(ZZ_p &nth, ZZ_p n, ZZ p){
	ZZ_p result;
	random(result);
	while(result==ZZ_p(0))
	{
		random(result);
	}
	long n1;
	conv (n1,n);
	long p1;
    //conv(n1,n);
	conv(p1,p);
	// If n|(p-1), then there exists n-th root of unity x which must satisfy x^((p-1)/n)!=1.
	// Later we check if x^t != 1 for t < n.
	while (power(result,(p1-1)/n1) == ZZ_p(1))
	{
		random(result);
		cout <<result<<endl;
	}
	cout<< power(result,(p1-1)/n1)<<" is a possible "<< n1<<"th root of unity"<<endl;
	nth=power(result,(p1-1)/n1);
	//return power(result,(p1-1)/n1);
	
}

ZZ_p findGenerator(ZZ p,ZZ_p result=ZZ_p(1)){

	//ZZ_p result(2);
	ZZ Nm1 = p-1;
	//Vec<ZZ> factors;
	//Vec<ZZ> powers;
	pair< Vec<ZZ> , Vec<ZZ> > factors = findprimefators(Nm1);
	long length =factors.first.length();
	bool isGen=true;
	//cout<<"here findgenerator"<< factors.first <<endl;
	do
	{
		result=result+1;

		//cout<<"here findgenerator"<<endl;

		//random(result);

		//while(result==ZZ_p(0))
		//{
			//random(result);

		//}
		isGen=true;
		for (long i = 0 ; i < length ; i++ )
		{
			//cout<<"here findgenerator2"<< factors.second <<endl;
			if  ((power(result,Nm1/factors.first[i]) == ZZ_p(1)))
			{
				isGen=false;
				break;
			}

		}	
		
	}while (!isGen);
	
	cout<< result <<" is generator"<<endl;
	return result;
	
}

bool isPrimRootOfUnity(ZZ_p n,const ZZ_p root, ZZ p)
{
	pair< Vec<ZZ> , Vec<ZZ> > factors = findprimefators(p-1);
	long n1;
	conv(n1,n);
	//vector<ZZ>::iterator ptr;
	//vector<ZZ>::iterator power;
	ZZ powers;
	ZZ factor;
	for (long j=0; j < factors.first.length(); j++ ){
		factor=factors.first[j];
		powers=factors.second[j];
		//conv(powers,factors.second[j]); 
		//j++;
		for (long i = 1; i< powers; i++){
			if (power(factor,i)>n1-1) // If the possible order is more than (n1-1)
				break;
			else {
				if (power(root,power(factor,i))==1)
				{
					cout<< root <<" is not "<< n <<"th prime root of unity but is"<< power(factor,i)<<"th root of unity"<<endl;
					cout<< factor <<" ^ "<< i<<"<= " <<n1-1 <<endl;
					return false;
				}
			}
		}
	}
	
	// Check if x^t != 1 for t < n
	/*for (long i =1; i<n1;i++)
	{
		//cout <<" i =  "<<i <<endl;
		if (power(root,i)==1)
		{
			cout<< root <<" is not "<< n <<"th root of unity"<<endl;
			return false;
		}
	}*/
	if ((power(root,n1)==ZZ_p(1)))
	{
	cout<< root <<" is "<< n <<"th prime root of unity"<<endl;
	return true;
	}

	cout<< root <<" is not "<< n <<"th root of unity"<<endl;
	return false;
}

//void Printres(vector)

void polyToShares(ZZ_pX& poly,
                   NTL::Vec<NTL::ZZ_p>& shares, ZZ_p a) {
	long order=512;  // order of the root
    long log_order=9;
    long size =64;
	poly.SetLength(size);
  	shares.SetLength(size);
    //NTL::FFTPrimeInfo* fft_info;
   // fft_info = new NTL::FFTPrimeInfo();
		long a1;
		conv(a1,a);
	//cout <<"Here 2.0"<<endl;

	//InitFFTPrimeInfo(*fft_info, 4611686018326724609, a1, 0);
		//cout <<"Here 2.01"<<endl;

	auto start = high_resolution_clock::now(); 
	//for (long i = 0; i<100;i++)
		//{
			//cout <<"Here 2.1"<<endl;
			NTL::new_fft((long*)shares.begin(), (long*)poly.rep.begin(), log_order,
		*fft_info, size, size);
		//}
					//cout <<"Here 2.2"<<endl;

	auto stop = high_resolution_clock::now(); 

	auto duration = duration_cast<microseconds>(stop - start); 
  
	// To get the value of duration use the count() 
	// member function on the duration object 
	//cout <<"duration = "<< duration.count() << endl; 
	//cout<<"shares= ";
	//for (int i=0;i<size;i++){
	//	cout<< shares[i]<< " ";
	//}
	//cout<<endl;
	}

void secrettopoly(const Vec<ZZ_p>& secrets, Vec<ZZ_p>& share,
                                ZZ_pX* poly,ZZ_p a){
	ZZ_pX buf;
  if (poly == nullptr) {
    poly = &buf;
  }
	long size=64;
	long log_order=9;
	Vec<ZZ_p> images;
  	images.SetLength(size);
  	for (int i = 0; i < size; i++) {
    	images[i] = secrets[i];
  	}
	share.SetLength(size);
	poly->SetLength(size);
	//cout <<"Here 2.1"<<endl;
	NTL::new_ifft((long*)poly->rep.begin(), (long*)images.begin(),log_order,
                *fft_info, size);

	//cout <<"Here 2.2"<<endl;
	//poly->normalize();
	/*cout<<"poly= ";
	for (int i =0; i<size;i++)
 		cout<<poly->rep[i]<<" ";
	cout<<endl;*/
	 polyToShares(*poly, share, a);
}

ZZ findPrimeWithFactores(long factor1,long factor2=1)
{
	long factor =factor1*factor2;
	ZZ tmp(factor);
	ZZ p=tmp+1;
	Vec<ZZ> primes;
	bool isprime = false;
	while(!isprime)
	{
		for (long i=3; i<50000000;i+=1)
		{
		if(NTL::ProbPrime(p)){

			if (p< 4611686018326724609){ // just having an upperbound for prime number
			primes.append(p);
			isprime = true;
			}
			//break;
			//cout<<"i= "<<i<<endl;
		}
		//tmp=tmp*2;
		p=tmp*i+1;
	//	if(NTL::ProbPrime(p))
	//		break;
	//	tmp=tmp*3;
	//	p=tmp+1;
		}
		cout<<"not found!"<<endl;

	}
	 ZZ maxprime(0);
	 
	 for (long i=0; i<primes.length();i++){
		 if (maxprime <primes[i])	
		 	maxprime = primes[i];
	 }
	/*Vec<ZZ> Numbers;
	//conv(Numbers,"[4611686018326724609 4611686018309947393 4611686018282684417 4611686018257518593 4611686018232352769 4611686018171535361 4611686018106523649 4611686018058289153 4611686018051997697 4611686017974403073 4611686017812922369 4611686017781465089 4611686017773076481 4611686017678704641 4611686017666121729 4611686017647247361 4611686017590624257 4611686017554972673 4611686017529806849 4611686017517223937 4611686017496252417 4611686017489960961 4611686017439629313 4611686017429143553 4611686017401880577 4611686017376714753 4611686017290731521 4611686017246691329 4611686017244594177 4611686017215234049 4611686017208942593 4611686017196359681 4611686017013907457 4611686016879689729 4611686016867106817 4611686016709820417 4611686016667877377 4611686016649003009 4611686016628031489 4611686016546242561 4611686016470745089 4611686016428802049 4611686016359596033 4611686016321847297 4611686016284098561 4611686016275709953 4611686016233766913 4611686016221184001 4611686016202309633 4611686016187629569 4611686016175046657 4611686016168755201 4611686016164560897 4611686016137297921 4611686016118423553 4611686016093257729 4611686015969525761 4611686015831113729 4611686015791267841 4611686015787073537 4611686015717867521 4611686015709478913 4611686015478792193 4611686015432654849 4611686015420071937 4611686015403294721 4611686015308922881 4611686015193579521 4611686015032098817 4611686015013224449 4611686015004835841 4611686014910464001 4611686014891589633 4611686014887395329 4611686014860132353 4611686014753177601 4611686014679777281 4611686014639931393 4611686014583308289 4611686014545559553 4611686014532976641 4611686014476353537 4611686014459576321 4611686014407147521 4611686014402953217 4611686014388273153 4611686014381981697 4611686014312775681 4611686014283415553 4611686014256152577 4611686014182752257 4611686014157586433 4611686014105157633 4611686014088380417 4611686014048534529 4611686013973037057 4611686013941579777 4611686013723475969 4611686013721378817 4611686013715087361 4611686013639589889 4611686013482303489 4611686013419388929 4611686013377445889 4611686013270491137 4611686013262102529 4611686013169827841 4611686013119496193 4611686013106913281 4611686013092233217 4611686013085941761 4611686013067067393 4611686013010444289 4611686012949626881 4611686012947529729 4611686012909780993 4611686012840574977 4611686012834283521 4611686012710551553 4611686012664414209 4611686012653928449 4611686012616179713 4611686012546973697 4611686012475670529 4611686012444213249 4611686012333064193 4611686012326772737 4611686012307898369 4611686012305801217 4611686012226109441 4611686012022685697 4611686011993325569 4611686011961868289 4611686011940896769 4611686011934605313 4611686011922022401 4611686011802484737 4611686011754250241 4611686011714404353 4611686011657781249 4611686011578089473 4611686011534049281 4611686011508883457 4611686011477426177 4611686011462746113 4611686011301265409 4611686011263516673 4611686011225767937 4611686011211087873 4611686011110424577 4611686011049607169 4611686010999275521 4611686010997178369 4611686010942652417 4611686010921680897 4611686010829406209 4611686010802143233 4611686010789560321 4611686010722451457 4611686010716160001 4611686010714062849 4611686010690994177 4611686010539999233 4611686010493861889 4611686010449821697 4611686010407878657 4611686010389004289 4611686010141540353 4611686010103791617 4611686010053459969 4611686010042974209 4611686010011516929 4611686009971671041 4611686009942310913 4611686009936019457 4611686009915047937 4611686009908756481 4611686009896173569 4611686009835356161 4611686009833259009 4611686009826967553 4611686009753567233 4611686009738887169 4611686009684361217 4611686009665486849 4611686009602572289 4611686009571115009 4611686009539657729 4611686009533366273 4611686009474646017 4611686009392857089 4611686009363496961 4611686009191530497 4611686009122324481 4611686009071992833 4611686008967135233 4611686008876957697 4611686008872763393 4611686008841306113 4611686008839208961 4611686008807751681 4611686008803557377 4611686008715476993 4611686008694505473 4611686008658853889 4611686008646270977 4611686008619008001 4611686008600133633 4611686008526733313 4611686008505761793 4611686008488984577 4611686008451235841 4611686008430264321 4611686008426070017 4611686008400904193 4611686008394612737 4611686008356864001 4611686008342183937 4611686008279269377 4611686008268783617 4611686008105205761 4611686008059068417 4611686007926947841 4611686007916462081 4611686007897587713 4611686007870324737 4611686007840964609 4611686007801118721 4611686007750787073 4611686007713038337 4611686007599792129 4611686007587209217 4611686007580917761 4611686007557849089 4611686007555751937 4611686007488643073 4611686007482351617 4611686007455088641 4611686007444602881 4611686007423631361 4611686007413145601 4611686007404756993 4611686007369105409 4611686007325065217 4611686007306190849 4611686007266344961 4611686007255859201 4611686007236984833 4611686007159390209 4611686007136321537 4611686007090184193 4611686007085989889 4611686007079698433 4611686007073406977 4611686006970646529 4611686006960160769 4611686006958063617 4611686006794485761 4611686006727376897 4611686006718988289 4611686006708502529 4611686006656073729 4611686006563799041 4611686006425387009 4611686006324723713 4611686006154854401 4611686006152757249 4611686006140174337 4611686006135980033 4611686006110814209 4611686006098231297 4611686006060482561 4611686005984985089 4611686005932556289 4611686005926264833 4611686005878030337 4611686005871738881 4611686005808824321 4611686005796241409 4611686005789949953 4611686005636857857 4611686005460697089 4611686005368422401 4611686005347450881 4611686005334867969 4611686005328576513 4611686005315993601 4611686005271953409 4611686005255176193 4611686005253079041 4611686005177581569 4611686005154512897 4611686005085306881 4611686005064335361 4611686005022392321 4611686004978352129 4611686004909146113 4611686004850425857 4611686004839940097 4611686004781219841 4611686004758151169 4611686004626030593 4611686004556824577 4611686004516978689 4611686004504395777 4611686004437286913 4611686004424704001 4611686004374372353 4611686004340817921 4611686004321943553 4611686004305166337 4611686004286291969 4611686004227571713 4611686004164657153 4611686004120616961 4611686004066091009 4611686004047216641 4611686004026245121 4611686004007370753 4611686003944456193 4611686003938164737 4611686003906707457 4611686003856375809 4611686003833307137 4611686003818627073 4611686003787169793 4611686003749421057 4611686003745226753 4611686003743129601 4611686003686506497 4611686003617300481 4611686003613106177 4611686003556483073 4611686003535511553 4611686003525025793 4611686003522928641 4611686003480985601 4611686003447431169 4611686003405488129 4611686003334184961 4611686003279659009 4611686003260784641 4611686003197870081 4611686003166412801 4611686003095109633 4611686003059458049 4611686002921046017 4611686002881200129 4611686002849742849 4611686002820382721 4611686002774245377 4611686002757468161 4611686002707136513 4611686002669387777 4611686002663096321 4611686002579210241 4611686002575015937 4611686002566627329 4611686002549850113 4611686002465964033 4611686002442895361 4611686002409340929 4611686002348523521 4611686002346426369 4611686002235277313 4611686002182848513 4611686002178654209 4611686002138808321 4611686002126225409 4611686002115739649 4611686002050727937 4611686002002493441 4611686002000396289 4611686001717280769 4611686001656463361 4611686001643880449 4611686001574674433 4611686001459331073 4611686001434165249 4611686001411096577 4611686001352376321 4611686001310433281 4611686001264295937 4611686001213964289 4611686001172021249 4611686001134272513 4611686001127981057 4611686001119592449 4611686001107009537 4611686001090232321 4611686001012637697 4611686000995860481 4611686000983277569 4611686000945528833 4611686000939237377 4611686000849059841 4611686000792436737 4611686000744202241 4611686000725327873 4611686000681287681 4611686000679190529 4611686000605790209 4611686000599498753 4611686000597401601 4611686000574332929 4611686000561750017 4611686000515612673 4611686000503029761 4611686000471572481 4611686000452698113 4611686000429629441 4611686000383492097 4611686000379297793 4611686000352034817 4611686000303800321 4611686000270245889 4611686000247177217 4611686000196845569 4611686000177971201 4611686000144416769 4611686000100376577 4611686000068919297 4611686000018587649 4611685999980838913 4611685999976644609 4611685999842426881 4611685999819358209 4611685999775318017 4611685999769026561 4611685999706112001 4611685999662071809 4611685999643197441 4611685999603351553 4611685999561408513 4611685999515271169 4611685999483813889 4611685999454453761 4611685999414607873 4611685999345401857 4611685999076966401 4611685998879834113 4611685998844182529 4611685998800142337 4611685998699479041 4611685998678507521 4611685998636564481 4611685998623981569 4611685998615592961 4611685998590427137 4611685998565261313 4611685998552678401 4611685998313603073 4611685998219231233 4611685998208745473 4611685998150025217 4611685998145830913 4611685998118567937 4611685998076624897 4611685998038876161 4611685997957087233 4611685997936115713 4611685997831258113 4611685997797703681 4611685997730594817 4611685997709623297 4611685997684457473 4611685997680263169 4611685997653000193 4611685997564919809 4611685997548142593 4611685997522976769 4611685997401341953 4611685997237764097 4611685997200015361 4611685997170655233 4611685997126615041 4611685997114032129 4611685996906414081 4611685996893831169 4611685996862373889 4611685996824625153 4611685996791070721 4611685996654755841 4611685996652658689 4611685996570869761 4611685996432457729 4611685996394708993 4611685996363251713 4611685996346474497 4611685996306628609 4611685996258394113 4611685996256296961 4611685996237422593 4611685996136759297 4611685996111593473 4611685996099010561 4611685996054970369 4611685996038193153 4611685996013027329 4611685995979472897 4611685995954307073 4611685995943821313 4611685995899781121 4611685995786534913 4611685995761369089 4611685995729911809 4611685995685871617 4611685995666997249 4611685995629248513 4611685995522293761 4611685995513905153 4611685995465670657 4611685995381784577 4611685995371298817 4611685995314675713 4611685995230789633 4611685995214012417 4611685995205623809 4611685995151097857 4611685995123834881 4611685995067211777 4611685995035754497 4611685995029463041 4611685994930896897 4611685994916216833 4611685994893148161 4611685994872176641 4611685994798776321 4611685994773610497 4611685994721181697 4611685994528243713 4611685994494689281 4611685994440163329 4611685994438066177 4611685994408706049 4611685994333208577 4611685994318528513 4611685994295459841 4611685994213670913 4611685994201088001 4611685994123493377 4611685994087841793 4611685993978789889 4611685993966206977 4611685993846669313 4611685993766977537 4611685993716645889 4611685993595011073 4611685993582428161 4611685993553068033 4611685993464987649 4611685993433530369 4611685993389490177 4611685993374810113 4611685993274146817 4611685993160900609 4611685993154609153 4611685993106374657 4611685993091694593 4611685993087500289 4611685993060237313 4611685993018294273 4611685992972156929 4611685992892465153 4611685992886173697 4611685992854716417 4611685992816967681 4611685992795996161 4611685992751955969 4611685992676458497 4611685992603058177 4611685992575795201 4611685992556920833 4611685992546435073 4611685992533852161 4611685992512880641 4611685992508686337 4611685992483520513 4611685992445771777 4611685992376565761 4611685992363982849 4611685992351399937 4611685992313651201 4611685992294776833 4611685992187822081 4611685992093450241 4611685992091353089 4611685991967621121 4611685991965523969 4611685991955038209 4611685991946649601 4611685991883735041 4611685991873249281 4611685991822917633 4611685991820820481 4611685991778877441 4611685991764197377 4611685991747420161 4611685991590133761 4611685991451721729 4611685991413972993 4611685991393001473 4611685991267172353 4611685991210549249 4611685991197966337 4611685991172800513 4611685991130857473 4611685991078428673 4611685991030194177 4611685991002931201 4611685990992445441 4611685990984056833 4611685990967279617 4611685990952599553 4611685990895976449 4611685990885490689 4611685990854033409 4611685990757564417 4611685990621249537 4611685990581403649 4611685990549946369 4611685990445088769 4611685990432505857 4611685990417825793 4611685990411534337 4611685990401048577 4611685990386368513 4611685990306676737 4611685990287802369 4611685990224887809 4611685990218596353 4611685990166167553 4611685990159876097 4611685990130515969 4611685990111641601 4611685990096961537 4611685990048727041 4611685990008881153 4611685989983715329 4611685989973229569 4611685989954355201 4611685989694308353 4611685989677531137 4611685989652365313 4611685989650268161 4611685989532827649 4611685989501370369 4611685989419581441 4611685989404901377 4611685989398609921 4611685989354569729 4611685989222449153 4611685989209866241 4611685989178408961 4611685989102911489 4611685989023219713 4611685989016928257 4611685988966596609 4611685988964499457 4611685988891099137 4611685988863836161 4611685988853350401 4611685988788338689 4611685988782047233 4611685988643635201 4611685988555554817 4611685988538777601 4611685988519903233 4611685988431822849 4611685988347936769 4611685988240982017 4611685988203233281 4611685988178067457 4611685988148707329 4611685988142415873 4611685988096278529 4611685988079501313 4611685988064821249 4611685987951575041 4611685987938992129 4611685987915923457 4611685987907534849 4611685987878174721 4611685987876077569 4611685987827843073 4611685987758637057 4611685987737665537 4611685987718791169 4611685987657973761 4611685987626516481 4611685987580379137 4611685987569893377 4611685987561504769 4611685987548921857 4611685987519561729 4611685987469230081 4611685987330818049 4611685987303555073 4611685987297263617 4611685987259514881 4611685987003662337 4611685986932359169 4611685986888318977 4611685986877833217 4611685986768781313 4611685986743615489 4611685986701672449 4611685986695380993 4611685986607300609 4611685986510831617 4611685986491957249 4611685986412265473 4611685986410168321 4611685986328379393 4611685986317893633 4611685986202550273 4611685986108178433 4611685986007515137 4611685985990737921 4611685985971863553 4611685985925726209 4611685985913143297 4611685985894268929 4611685985864908801 4611685985852325889 4611685985833451521 4611685985808285697 4611685985755856897 4611685985730691073 4611685985686650881 4611685985604861953 4611685985588084737 4611685985497907201 4611685985380466689 4611685985374175233 4611685985367883777 4611685985359495169 4611685985317552129 4611685985242054657 4611685985172848641 4611685985128808449 4611685985088962561 4611685984996687873 4611685984994590721 4611685984963133441 4611685984950550529 4611685984940064769 4611685984780681217 4611685984724058113 4611685984719863809 4611685984606617601 4611685984560480257 4611685984554188801 4611685984468205569 4611685984398999553 4611685984378028033 4611685984367542273 4611685984336084993 4611685984273170433 4611685984203964417 4611685984166215681 4611685984151535617 4611685984008929281 4611685983952306177 4611685983927140353 4611685983901974529 4611685983870517249 4611685983843254273 4611685983826477057 4611685983820185601 4611685983811796993 4611685983763562497 4611685983579013121 4611685983560138753 4611685983547555841 4611685983417532417 4611685983354617857 4611685983285411841 4611685983264440321 4611685983260246017 4611685983222497281 4611685983094571009 4611685983056822273 4611685983044239361 4611685983025364993 4611685982970839041 4611685982748540929 4611685982725472257 4611685982679334913 4611685982666752001 4611685982643683329 4611685982572380161 4611685982517854209 4611685982486396929 4611685982484299777 4611685982452842497 4611685982417190913 4611685982404608001 4611685982379442177 4611685982364762113 4611685982360567809 4611685982358470657 4611685982322819073 4611685982316527617 4611685982276681729 4611685982232641537 4611685982140366849 4611685982081646593 4611685982071160833 4611685982033412097 4611685981993566209 4611685981987274753 4611685981976788993 4611685981767073793 4611685981735616513 4611685981712547841 4611685981704159233 4611685981697867777 4611685981668507649 4611685981630758913 4611685981624467457 4611685981603495937 4611685981561552897 4611685981389586433 4611685981383294977 4611685981353934849 4611685981351837697 4611685981322477569 4611685981301506049 4611685981295214593 4611685981219717121 4611685981215522817 4611685981169385473 4611685981163094017 4611685981146316801 4611685981133733889 4611685981064527873 4611685981033070593 4611685980949184513 4611685980917727233 4611685980882075649 4611685980819161089 4611685980705914881 4611685980672360449 4611685980661874689 4611685980655583233 4611685980548628481 4611685980464742401 4611685980397633537 4611685980345204737 4611685980296970241 4611685980225667073 4611685980127100929 4611685980108226561 4611685980095643649 4611685980074672129 4611685980068380673 4611685980055797761 4611685980036923393 4611685979988688897 4611685979919482881 4611685979904802817 4611685979856568321 4611685979791556609 4611685979743322113 4611685979716059137 4611685979674116097 4611685979659436033 4611685979583938561 4611685979579744257 4611685979508441089 4611685979497955329 4611685979458109441 4611685979407777793 4611685979376320513 4611685979307114497 4611685979212742657 4611685979120467969 4611685979076427777 4611685978982055937 4611685978929627137 4611685978879295489 4611685978856226817 4611685978835255297 4611685978805895169 4611685978799603713 4611685978753466369 4611685978747174913 4611685978627637249 4611685978554236929 4611685978533265409 4611685978522779649 4611685978495516673 4611685978438893569 4611685978357104641 4611685978346618881 4611685978331938817 4611685978313064449 4611685978243858433 4611685978069794817 4611685978023657473 4611685977975422977 4611685977956548609 4611685977874759681 4611685977759416321 4611685977702793217 4611685977633587201 4611685977545506817 4611685977482592257 4611685977472106497 4611685977457426433 4611685977295945729 4611685977205768193 4611685977170116609 4611685977130270721 4611685977100910593 4611685977075744769 4611685977035898881 4611685976949915649 4611685976922652673 4611685976918458369 4611685976878612481 4611685976796823553 4611685976761171969 4611685976647925761 4611685976553553921 4611685976545165313 4611685976503222273 4611685976465473537 4611685976427724801 4611685976381587457 4611685976364810241 4611685976362713089 4611685976350130177 4611685976320770049 4611685976283021313 4611685976213815297 4611685976136220673 4611685976111054849 4611685976025071617 4611685975993614337 4611685975955865601 4611685975804870657 4611685975765024769 4611685975746150401 4611685975720984577 4611685975672750081 4611685975601446913 4611685975576281089 4611685975569989633 4611685975534338049 4611685975528046593 4611685975515463681 4611685975475617793 4611685975437869057 4611685975412703233 4611685975406411777 4611685975337205761 4611685975333011457 4611685975270096897 4611685975263805441 4611685975255416833 4611685975251222529 4611685975238639617 4611685975230251009 4611685975135879169 4611685975117004801 4611685975035215873 4611685975028924417 4611685974986981377 4611685974867443713 4611685974829694977 4611685974815014913 4611685974710157313 4611685974653534209 4611685974651437057 4611685974546579457 4611685974525607937 4611685974496247809 4611685974452207617 4611685974351544321 4611685974217326593 4611685974194257921 4611685974192160769 4611685974173286401 4611685974169092097 4611685974087303169 4611685974018097153 4611685973974056961 4611685973940502529 4611685973902753793 4611685973860810753 4611685973858713601 4611685973797896193 4611685973728690177 4611685973646901249 4611685973644804097 4611685973544140801 4611685973502197761 4611685973500100609]");
	//cout<< Numbers<<endl;
	long sizeNumbers=Numbers.length();
	cout<<"sizeNumbers= "<<sizeNumbers<<endl;
	long index=0;
	ZZ factor3(factor);
	for (long i=0;i<sizeNumbers;i++)
		{
			if ((Numbers[i]-1)%factor1==0)
			{
				cout << "the prime from list is: "<<Numbers[i]<<endl;
				break;
			}
		}*/

	return maxprime;
}

// Generate a prime p number s.t. p-1 has at least the factors  factor1 and factor1. it can have more factors 
ZZ findPrimeWithFactores(ZZ factor1,ZZ factor2=ZZ(1))
{
	ZZ factor =factor1*factor2;
	ZZ tmp=factor;
	ZZ p=tmp+1;
	Vec<ZZ> primes;
	bool isprime = false;
	while(!isprime)
	{
		for (long i=129; i<50000000;i+=1)//change the starting i to adjust the desired number of bits in the prime number
		{
		if(NTL::ProbPrime(p)){

			
			primes.append(p);
			isprime = true;
		
			break;
			//cout<<"i= "<<i<<endl;
		}
		//tmp=tmp*2;
		p=tmp*i+1;
	//	if(NTL::ProbPrime(p))
	//		break;
	//	tmp=tmp*3;
	//	p=tmp+1;
		}
		//cout<<"not found!"<<endl;

	}

	return primes[0];
}


int main()
{
	long degree=63;
	ofstream myfile;
	myfile.open ("test.txt");
  	myfile << "Writing this to a file.\n";

	  ZZ twoten(1024);
	  ZZ twopower(1);
	  for (int i=0; i<9;i++)
	  twopower=twopower*twoten;	
	  twopower=twopower*32;
	  //twopower=twopower*twopower;
	//cout <<"twopower is= " << twopower<< endl;

	ZZ theprime=findPrimeWithFactores(twopower,ZZ(43046721));
	cout <<"theprime is= " << theprime<< endl;
	//return 0;
   ZZ p(4610415792919412737);
   //ZZ p(4611686018309947393);
   // 4606759634479349760 = 2^22 × 3^22 × 5 × 7
   // 4610415792919412736 = 2^20 × 3^20 × 13 × 97
   //ZZ p(11);
   //cin >> p;
   	//cout<<"here"<<endl;

   ZZ_p::init(theprime);
   // size of input vector to NTT
   long n1=512; 
   //long n1=5;
	ZZ_p n(n1);
   ZZ_p Nm1;//(4610415792919412736);
   conv(Nm1,theprime-1);
   cout << "Nm1 ="<<Nm1<<endl;
	//findprimefators((p-1)*(p-1));

   //ZZ_p Nm1(4611686018309947392); // p-1 (or N-1)
   //ZZ_p Nm1(10);
   //cin >> Nm1;
	//ZZ_p k=Nm1/n;
	//long k;
	ZZ k;
	conv(k,Nm1/n);
	//conv(k,576460752290840576);
   //Vec< Pair< ZZ_pX, long > > factors;

   //CanZass(factors, f);  // calls "Cantor/Zassenhaus" algorithm
   //cout <<"f/"<< n <<"= "<< Nm1/n << "\n";
   cout<<"k= "<<k<<endl;
   //ZZ_p a(18495196423556860);//=findGenerator(4610415792919412737);// use factors from https://www.alpertron.com.ar/ECM.HTM
	ZZ_p theGenerator =findGenerator(theprime,ZZ_p(2));

   ZZ_p a;// =findGenerator(ZZ(4610415792919412737));
   //cout<< a <<" is generator"<<endl;
   ZZ_p nth=power(theGenerator,k);
   //ZZ_p nth1=findnthRoot(n,p);
	cout<<"here :: "<<power(nth,n1)<<endl;
	cout<<"nth= "<<nth<<endl;
	//return 0;
	//nth=nth-1;
   //make sure nth is a primitive root of unity
   //myfile<< nth <<" is "<< n <<"th root of unity "<< power(nth,n1)<<endl;
   ZZ seed(1112);
   //cout<<isPrimRootOfUnity(n,nth,theprime)<<endl;
  // return 0;
   while (!isPrimRootOfUnity(n,nth,theprime))
   {
	   //NTL::SetSeed(seed);
	   nth.zero();
	   findnthRoot(nth,n,theprime);
	   cout << seed << " is seed"<<endl;
	   seed++;
   }
   //return 0;
	// Input vector
	Vec<ZZ_p> X;
	//conv(X,"[28242313 60369787 26821352 707636 31300454 38710545 68665486 25767172 34018410 52396947 66485126 20710657 59189197 8909111 60111186 2479862 15780325 46995328 41390258 23321871 57043873 46818189 59368841 37820285 39378538 34883425 63516991 57374755 17574093 22880381 9937958 54143610]");
	X.SetLength(n1);
	/*X[0]= ZZ_p(6);
	X[1]= ZZ_p(0);
	X[2]= ZZ_p(10);
	X[3]= ZZ_p(7);
	X[4]= ZZ_p(2);*/
	
	//nth=ZZ_p(3);

	//Output vector of NTT
	Vec<ZZ_p> Y;
	Y.SetLength(n1);

	//Compute NTT
	ZZ_p tmp;
	for (long i = 0; i<n1; i++)
	{
		X[i] = (random_ZZ_p());
	}
	//cout <<"X ="<< X<<endl;

	Vec<ZZ_p> W;
	W.SetLength(n1);
	for (long k = 0; k<n1; k++)
	{
		tmp = 0;
		tmp += power(ZZ_p(3125141995714774395),-k);
	
		W[k]=tmp;
	}
	//cout <<"W ="<< W<<endl;

	for (long k = 0; k<n1; k++)
	{
		tmp = 0;
			for (long i = 0; i<n1; i++)
		{
			tmp += X[i]*power(nth,i*k);
		}
		Y[k]=tmp;
	}
	//cout <<endl<<"+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+="<<endl;
	//cout <<"+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+="<<endl;
	//cout <<"+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+="<<endl<<endl;

	//cout <<"Y ="<< Y<<endl;

	//Output vector of invNTT
	Vec<ZZ_p> Z;
	Z.SetLength(n1);
	//Compute invNTT
	for (long k = 0; k<n1; k++)
	{
		tmp = 0;
		for (long i = 0; i<n1; i++)
		{
			tmp += Y[i]*power(nth,-i*k);
		}
		Z[k]=tmp/n1;
	}
	//cout <<"Z ="<< Z<<endl;
	
	cout <<"Z-X ="<< Z-X<<endl;
	
	//cout<<"a generator is: "<<f<<endl;


		//cout <<"Here 0"<<endl;

    fft_info = new NTL::FFTPrimeInfo();
		//cout <<"Here 00"<<endl;
		//ZZ_p a1;
		long a1;
		conv(a1,a);
	InitFFTPrimeInfo(*fft_info, 4611686018326724609, a1, 0);
	ZZ_pX poly;
	//ZZ_pX buf;
	//poly = &buf;

	long order=512;  // order of the root
    long log_order=9;
	long size = degree + 1;	//zz_pX buf;
    //poly->SetLength(size);
	
	//cout <<"Here 1"<<endl;
	//Vec<ZZ_p> share;
	//share.SetLength(size);
	Vec<ZZ_p> images;
	images.SetLength(size);
	//cout<<"images[i]=" <<" ";
	for (long i = 0; i<size; i++)
	{
			//cout <<"i=" << i<<endl;

		//conv(images[i],4285050990392141267);// = (random_zz_p());
		images[i]= random_ZZ_p();
		//cout<<images[i]<<" ";
	}
	//cout <<"Here 1.1"<<endl;

  //NTL::new_ifft((long*)poly->rep.begin(), (long*)images.begin(), log_order,
  //              *fft_info, size);
				//cout <<"Here 2"<<endl;
  /*for (int i = 0; i < size; i++) {
    poly->rep[i] =
        NTL::MulModPrecon(poly->rep[i]._ZZ_p__rep, rootTable[order - i], prime,
                          precondTable[order - i]);
  }*/
	//cout <<"Here 1.2"<<endl;
	//poly->normalize();
	//cout<<"poly= ";
	//for (int i =0; i<size;i++)
 	//	cout<<poly->rep[i]<<" ";
	//cout<<endl;
	//secrettopoly(images, share, &poly,a);
	 //polyToShares(*poly, share, a);
	//cout <<"Here 1.3"<<endl;
	//char t;
	//cin>> t;
	return 0;
	
}
